{% from "__helpers.html" import render_field with context %}
{% extends 'layout.html' %}

{% block body %}
{% block content %}
<div id="foo" style="width:800px; margin:0 auto;">
    
    <form name = 'hospital_form'  method="post" > 
        {{ hospital_form.csrf_token() }}
        {{ render_field(hospital_form.all_hospitals) }}
    </form> 
    <button onclick = "clinicFunction();">Next</button>

    <form name = 'clinic_form'  method="post"> 
        {{ clinic_form.csrf_token() }}
        {{ render_field(clinic_form.clinics) }}
    </form>
    
    
</div>
{% endblock %}
{% endblock %}

{% block script%}
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>

<script>
    function clinicFunction() {
        var csrf_token = "{{ csrf_token() }}";

        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrf_token);
                }
            }
        });

        var my = $('#all_hospitals option:selected').val()
        var data1 = {'selected_hospital': my}
        $.ajax({
            url: 'get-clinics',
            data: JSON.stringify(data1),
            method: 'POST',
            contentType: 'application/json',
            success: function(data) {
                $('#foo').replaceWith(data);
            }
        });
    };
</script>

{%endblock%}